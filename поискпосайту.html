<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сертификаты компаний</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        /* Основной контейнер */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Красивый заголовок */
        h1 {
            text-align: center;
            font-size: 2.5em;
            color: #00695c;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        @media (max-width:500px) {
            h1 {
                font-size: 1.5em;
            }
        }

        /* Стили для поисковой формы */
        .search-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        input[type="text"] {
            padding: 10px;
            font-size: 1.1em;
            border: 1px solid #ccc;
            border-radius: 30px;
            width: 100%;
            margin-bottom: 10px;
            box-sizing: border-box;
        }

        .search-inputs {
            width: 100%;
            max-width: 400px;
        }

        button {
            padding: 10px 30px;
            font-size: 1.1em;
            background-color: #00695c;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 20px;
            margin-top: 10px;
        }

        button:hover {
            background-color: #004d40;
        }

        /* Результаты поиска */
        .result-item {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 20px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.458);
        }

        .result-item p {
            margin: 5px 0;
        }

    </style>
</head>
<body>

    <div class="container">
        <!-- Красивый заголовок -->
        <h1>Сертификаты компаний</h1>

        <!-- Поля для поиска -->
        <div class="search-container">
            <div class="search-inputs">
                <input type="text" id="company-name" placeholder="Введите название компании..." onkeydown="handleKeyPress(event)">
                <input type="text" id="inn" placeholder="Введите ИНН..." onkeydown="handleKeyPress(event)">
                <input type="text" id="cert-number" placeholder="Введите номер сертификата..." onkeydown="handleKeyPress(event)">
            </div>
            <button id="search-button" onclick="search()">Проверить сертификат</button>
        </div>

        <!-- Результаты поиска -->
        <div id="search-results"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        let data = [];

        // Загрузка Excel-файла по ссылке
        const excelFileUrl = "https://raw.githubusercontent.com/Legenda1cr/Legendacompany/master/%D1%81%D0%B5%D1%80%D1%82%D0%B8%D1%84%D0%B8%D0%BA%D0%B0%D1%82%D1%8B.xlsx"; 

        fetch(excelFileUrl)
            .then(response => response.arrayBuffer())
            .then(dataBuffer => {
                const workbook = XLSX.read(dataBuffer, {type: 'array'});
                const sheetName = workbook.SheetNames[0];  // Используем первый лист
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                data = jsonData.map(item => ({
                    companyName: item["Название компании"],
                    certNumber: item["Номер сертификата"],
                    inn: String(item["ИНН"]), // Преобразуем ИНН в строку
                    location: item["Адрес"],
                    certCriteria: item["Стандарт"],
                    accreditation: item["Аккредитация"],
                    expirationDate: formatExcelDate(item["Срок действия сертификата"]),
                    lastAuditDate: formatExcelDate(item["Дата последнего аудита"]),
                    isActive: item["Статус сертификата"].trim().toLowerCase() === 'действующий'

                }));
            })
            .catch(error => console.error('Ошибка при загрузке Excel:', error));

        // Функция для преобразования даты из Excel
        function formatExcelDate(excelDate) {
            if (!excelDate) return 'Дата не указана';
            const date = new Date(Math.round((excelDate - 25569) * 86400 * 1000)); // Преобразование даты из формата Excel
            return date.toLocaleDateString('ru-RU');
        }

        // Функция для поиска
        function search() {
            const certInput = document.getElementById('cert-number').value.trim().toLowerCase();
            const innInput = document.getElementById('inn').value.trim().toLowerCase();
            const nameInput = document.getElementById('company-name').value.trim().toLowerCase();
            const resultsContainer = document.getElementById('search-results');

            // Очищаем предыдущие результаты
            resultsContainer.innerHTML = '';

            // Проверяем, введены ли хоть какие-то данные
            if (!certInput && !innInput && !nameInput) {
                return; // Если все поля пустые, ничего не выводим
            }

            // Фильтруем данные по условиям
            const filteredData = data.filter(item => {
                const certMatches = certInput ? item.certNumber.toLowerCase() === certInput : true; // Полное совпадение по сертификату
                const innMatches = innInput ? item.inn.toLowerCase() === innInput : true; // Полное совпадение по ИНН
        
                const nameInQuotes = item.companyName.match(/"([^"]+)"/);
                const companyNameInQuotes = nameInQuotes ? nameInQuotes[1].toLowerCase() : ''; // Выделяем содержимое в кавычках
                const fullCompanyName = item.companyName.toLowerCase(); // Полное название компании с кавычками

                // Проверка на полное совпадение содержимого в кавычках, полного названия или на наличие кавычек вокруг введённого текста
                const nameMatches = nameInput
                    ? (companyNameInQuotes === nameInput || fullCompanyName === nameInput || `"${companyNameInQuotes}"` === nameInput)
                    : true;

                return certMatches && innMatches && nameMatches;
            });

            // Выводим результаты поиска
            if (filteredData.length > 0) {
                filteredData.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'result-item';
                    div.innerHTML = `
                        <p><strong>Название компании:</strong> ${item.companyName}</p>
                        <p><strong>Номер сертификата:</strong> ${item.certNumber}</p>
                        <p><strong>ИНН:</strong> ${item.inn}</p>
                        <p><strong>Адрес:</strong> ${item.location}</p>
                        <p><strong>Стандарт:</strong> ${item.certCriteria}</p>
                        <p><strong>Аккредитация:</strong> ${item.accreditation}</p>
                        <p><strong>Срок действия сертификата:</strong> ${item.expirationDate}</p>
                        <p><strong>Дата последнего аудита:</strong> ${item.lastAuditDate}</p>
                        <p><strong>Статус сертификата:</strong> ${item.isActive ? 'Действующий' : 'Не действующий'}</p>
                    `;
                    resultsContainer.appendChild(div);
                });
            } else {
                resultsContainer.innerHTML = '<p>Сертификаты не найдены.</p>';
            }
        }

        // Обработка нажатия Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                search();
            }
        }
    </script>
</body>
</html>
